# 年度回顾功能 - 项目文件总览

## 📁 项目结构

```
git/
├── extensions/
│   └── year_review.lua                    # 核心功能模块（主文件）
├── year_review_test.lua                   # 测试和使用示例
├── year_review_integration.lua            # 集成配置示例
├── year_review_viewer.lua                 # 数据查看器工具
├── 年度回顾功能说明.md                    # 详细使用文档
├── YEAR_REVIEW_README.md                  # 项目说明文档
└── year_review_data.json                  # 数据存储文件（运行后自动生成）
```

## 📄 文件说明

### 1. year_review.lua（核心模块）⭐
**位置**: `extensions/year_review.lua`  
**作用**: 年度回顾功能的核心实现

**主要功能**:
- 自动记录玩家游戏数据
- 7个触发器监听游戏事件
- 数据持久化存储（JSON格式）
- 生成文本和HTML格式报告

**主要函数**:
- `ShowYearReview(player_name, year)` - 显示年度回顾
- `ExportYearReviewHTML(player_name, year, output_file)` - 导出HTML报告

**统计内容**:
- ✅ 武将使用和胜率
- ✅ 身份统计
- ✅ 技能使用频率
- ✅ 卡牌使用频率
- ✅ 战斗数据（伤害、击杀、死亡）
- ✅ 卡牌流转（摸牌、弃牌）

### 2. year_review_test.lua（测试示例）
**位置**: `year_review_test.lua`  
**作用**: 提供使用示例和测试代码

**包含内容**:
- 8个使用示例
- 自动生成回顾功能
- 数据备份功能
- 年份对比功能
- 排行榜生成

### 3. year_review_integration.lua（集成配置）
**位置**: `year_review_integration.lua`  
**作用**: 展示如何将功能集成到现有项目

**包含内容**:
- 3种集成方式
- 安装验证函数
- 自动显示功能
- 自定义命令注册
- 定期提醒功能
- 数据迁移工具

### 4. year_review_viewer.lua（数据查看器）
**位置**: `year_review_viewer.lua`  
**作用**: 提供强大的数据查询和分析工具

**主要功能**:
- `ListAllPlayers()` - 列出所有玩家
- `RankPlayersByYear(year)` - 年度排行榜
- `YearOverview(year)` - 年度数据总览
- `ComparePlayers(player1, player2, year)` - 玩家对比
- `FindTopPlayerForGeneral(general_name, year)` - 武将使用排行

### 5. 年度回顾功能说明.md（使用文档）
**位置**: `年度回顾功能说明.md`  
**作用**: 详细的使用说明文档

**包含内容**:
- 功能概述
- 统计内容详解
- 安装方法
- 使用方法
- 数据结构说明
- 注意事项
- 高级功能
- 示例输出

### 6. YEAR_REVIEW_README.md（项目说明）
**位置**: `YEAR_REVIEW_README.md`  
**作用**: 项目总体说明和快速入门

**包含内容**:
- 项目简介
- 功能特性
- 快速开始指南
- 数据示例
- 技术细节
- 常见问题
- 更新计划

## 🚀 快速开始

### 最小安装（只需一个文件）

1. 将 `extensions/year_review.lua` 放入游戏的 `extensions` 目录
2. 确保游戏会加载该文件
3. 开始游戏，功能自动启用

### 完整安装（推荐）

1. 复制所有文件到对应位置
2. 在主加载文件中添加: `require "extensions.year_review"`
3. 运行测试验证安装

### 验证安装

在Lua控制台中运行:
```lua
dofile("year_review_integration.lua")
VerifyYearReviewInstallation()
```

## 📊 使用场景

### 场景1: 游戏结束后查看回顾
```lua
ShowYearReview("玩家名")
```

### 场景2: 导出精美报告
```lua
ExportYearReviewHTML("玩家名", "2024", "my_review.html")
```

### 场景3: 查看排行榜
```lua
dofile("year_review_viewer.lua")
RankPlayersByYear("2024")
```

### 场景4: 数据分析
```lua
dofile("year_review_viewer.lua")
YearOverview("2024")
```

### 场景5: 玩家对比
```lua
dofile("year_review_viewer.lua")
ComparePlayers("玩家1", "玩家2", "2024")
```

## 🔧 数据文件

### year_review_data.json
**自动生成**: 首次运行后自动创建  
**格式**: JSON  
**编码**: UTF-8

**数据结构**:
```json
{
  "CurrentYear": "2024",
  "PlayerStats": {
    "玩家名": {
      "2024": {
        "total_games": 100,
        "total_wins": 58,
        "generals": {},
        "skills_used": {},
        "cards_used": {},
        "damage_dealt": 678,
        "damage_taken": 456,
        ...
      }
    }
  }
}
```

**备份建议**: 
- 定期备份该文件
- 使用版本控制
- 重要数据云端存储

## 🎯 核心特性

### 1. 自动化
- ✅ 无需手动操作
- ✅ 实时记录数据
- ✅ 自动分类存储

### 2. 全面性
- ✅ 记录7大类数据
- ✅ 支持多年份统计
- ✅ 多玩家数据管理

### 3. 灵活性
- ✅ 文本/HTML双格式
- ✅ 可自定义统计项
- ✅ 易于扩展

### 4. 性能
- ✅ 异步处理
- ✅ 最小化性能影响
- ✅ 优化数据结构

## 📈 统计项目明细

| 类别 | 统计项 | 说明 |
|------|--------|------|
| 基础数据 | 总场次 | 全年游玩局数 |
| | 总胜场 | 全年获胜局数 |
| | 胜率 | 获胜百分比 |
| 武将数据 | 使用次数 | 每个武将的使用次数 |
| | 武将胜率 | 每个武将的胜率 |
| | Top排行 | 最常用武将排名 |
| 身份数据 | 各身份场次 | 主/忠/反/内的游玩次数 |
| | 各身份胜率 | 各身份的胜率 |
| 技能数据 | 使用次数 | 每个技能的触发次数 |
| | Top排行 | 最常用技能排名 |
| 卡牌数据 | 使用次数 | 每种卡牌的使用次数 |
| | Top排行 | 最常用卡牌排名 |
| 战斗数据 | 造成伤害 | 累计造成的伤害值 |
| | 承受伤害 | 累计承受的伤害值 |
| | 击杀数 | 累计击杀角色数 |
| | 死亡数 | 累计死亡次数 |
| 卡牌流转 | 摸牌数 | 累计摸牌数量 |
| | 弃牌数 | 累计弃牌数量 |

## 🛠️ 技术实现

### 触发器系统
```
游戏开始 → YearReviewGameStartRecorder
游戏结束 → YearReviewGameOverRecorder
技能使用 → YearReviewSkillRecorder
卡牌使用 → YearReviewCardRecorder
造成伤害 → YearReviewDamageRecorder
角色死亡 → YearReviewKillRecorder
卡牌移动 → YearReviewCardMoveRecorder
```

### 数据流程
```
游戏事件 → 触发器捕获 → 数据处理 → JSON存储
                              ↓
                         查询/导出 ← 用户调用
```

## 📝 使用建议

### 开发者
1. 阅读 `year_review.lua` 了解核心实现
2. 参考 `year_review_integration.lua` 进行集成
3. 使用 `year_review_test.lua` 测试功能

### 玩家
1. 阅读 `年度回顾功能说明.md` 了解使用方法
2. 使用 `year_review_viewer.lua` 查看数据
3. 导出 HTML 报告分享给朋友

### 管理员
1. 定期备份 `year_review_data.json`
2. 监控文件大小，适时归档旧数据
3. 使用查看器生成服务器统计报告

## 🎨 HTML报告特性

- 📱 响应式设计，支持手机/平板查看
- 🎨 现代化UI，清晰美观
- 📊 数据表格，易于阅读
- 🖨️ 打印友好，可直接打印
- 🌈 彩色高亮，重要数据突出

## 🔄 更新和维护

### 当前版本
v1.0.0 (2024-12-10)

### 未来计划
- [ ] 图表可视化
- [ ] Excel导出
- [ ] 在线排行榜
- [ ] 移动端App
- [ ] 社交分享功能

## 💡 常见问题

**Q: 会影响游戏性能吗？**  
A: 影响极小，所有操作都是异步的。

**Q: 数据存在哪里？**  
A: 游戏目录下的 `year_review_data.json` 文件。

**Q: 可以统计历史数据吗？**  
A: 不能，只能统计安装后的新数据。

**Q: 支持多人吗？**  
A: 支持，每个玩家的数据独立存储。

**Q: 如何备份数据？**  
A: 直接复制 `year_review_data.json` 文件。

## 📞 技术支持

如有问题或建议，请：
1. 查看文档
2. 检查安装
3. 查看错误日志
4. 联系开发者

## 📜 许可证

MIT License - 自由使用和修改

---

**祝游戏愉快！享受你的年度回顾！** 🎮🎊
