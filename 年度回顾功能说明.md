# 年度回顾功能使用说明

## 功能概述

年度回顾功能会自动记录玩家在三国杀游戏中的各项数据，并可以生成详细的年度统计报告。

## 统计内容

### 1. 个人数据
- **总场次**：本年度游玩的总局数
- **总胜场**：本年度获胜的局数
- **胜率**：胜场/总场次的百分比

### 2. 武将数据
- 最常使用的武将（Top 10）
- 每个武将的使用次数
- 每个武将的胜场数和胜率

### 3. 身份统计
- 主公、忠臣、反贼、内奸各身份的：
  - 游玩场次
  - 胜利场次
  - 胜率

### 4. 技能统计
- 最常使用的技能（Top 10）
- 每个技能的使用次数

### 5. 卡牌统计
- 最常使用的锦囊/装备（Top 10）
- 每种卡牌的使用次数

### 6. 战斗数据
- 造成的总伤害
- 承受的总伤害
- 击杀数
- 死亡数

### 7. 卡牌数据
- 摸牌总数
- 弃牌总数

## 安装方法

1. 将 `year_review.lua` 文件放入 `extensions` 目录下
2. 确保游戏会加载该扩展文件
3. 重启游戏，功能将自动启用

## 使用方法

### 自动记录
年度回顾功能会在游戏进行中自动记录所有数据，无需手动操作。

### 查看年度回顾

在 Lua 控制台或游戏脚本中调用：

```lua
-- 查看指定玩家的当前年度回顾
ShowYearReview("玩家名")

-- 查看指定玩家的指定年份回顾
ShowYearReview("玩家名", "2024")
```

### 导出为 HTML 格式

```lua
-- 导出当前年度的回顾为 HTML 文件
ExportYearReviewHTML("玩家名")

-- 导出指定年份的回顾为 HTML 文件
ExportYearReviewHTML("玩家名", "2024")

-- 导出到指定文件名
ExportYearReviewHTML("玩家名", "2024", "my_review.html")
```

导出的 HTML 文件可以用浏览器打开，查看美化后的年度回顾报告。

## 数据存储

所有数据存储在 `year_review_data.json` 文件中，文件格式为 JSON，方便备份和迁移。

### 数据结构示例

```json
{
  "CurrentYear": "2024",
  "PlayerStats": {
    "玩家1": {
      "2024": {
        "year": "2024",
        "player_name": "玩家1",
        "total_games": 100,
        "total_wins": 58,
        "generals": {
          "caocao": {
            "play_count": 15,
            "win_count": 10
          },
          "liubei": {
            "play_count": 12,
            "win_count": 8
          }
        },
        "skills_used": {
          "jianxiong": 145,
          "rende": 98
        },
        "cards_used": {
          "slash": 234,
          "peach": 67,
          "lightning": 12
        },
        "damage_dealt": 678,
        "damage_taken": 456,
        "kills": 89,
        "deaths": 42,
        "card_drawn": 1234,
        "card_discarded": 567,
        "roles_stats": {
          "lord": { "play": 25, "win": 18 },
          "loyalist": { "play": 25, "win": 15 },
          "rebel": { "play": 25, "win": 13 },
          "renegade": { "play": 25, "win": 12 }
        }
      }
    }
  }
}
```

## 注意事项

1. **性能影响**：由于需要记录大量数据，可能会对游戏性能产生轻微影响
2. **数据准确性**：首次启用后才开始记录，之前的游戏数据不会被统计
3. **数据备份**：建议定期备份 `year_review_data.json` 文件
4. **跨年处理**：系统会自动按年份分类统计，不同年份的数据互不影响

## 高级功能

### 清除特定年份数据

如需清除某个年份的数据，可以手动编辑 `year_review_data.json` 文件，删除对应年份的数据块。

### 合并多个玩家数据

如果需要统计多个玩家账号的数据，可以手动编辑 JSON 文件进行合并。

### 自定义统计

可以修改 `year_review.lua` 中的代码来添加更多自定义统计项目。

## 示例输出

```
======== 2024 年度回顾 ========
玩家: Player1

【总体数据】
总场次: 100
总胜场: 58
胜率: 58.00%

【最常使用的武将】
1. 曹操 - 使用15次, 胜10场, 胜率66.67%
2. 刘备 - 使用12次, 胜8场, 胜率66.67%
3. 孙权 - 使用11次, 胜7场, 胜率63.64%
4. 诸葛亮 - 使用10次, 胜6场, 胜率60.00%
5. 吕布 - 使用9次, 胜5场, 胜率55.56%

【身份统计】
主公: 25场, 胜18场, 胜率72.00%
忠臣: 25场, 胜15场, 胜率60.00%
反贼: 25场, 胜13场, 胜率52.00%
内奸: 25场, 胜12场, 胜率48.00%

【最常使用的技能】
1. 奸雄 - 使用145次
2. 仁德 - 使用98次
3. 制衡 - 使用87次
4. 观星 - 使用76次
5. 武圣 - 使用65次

【最常使用的卡牌】
1. 杀 - 使用234次
2. 闪 - 使用198次
3. 桃 - 使用67次
4. 决斗 - 使用45次
5. 南蛮入侵 - 使用34次

【战斗数据】
造成伤害: 678
承受伤害: 456
击杀数: 89
死亡数: 42

【卡牌数据】
摸牌数: 1234
弃牌数: 567

==============================
```

## 技术支持

如有问题或建议，请联系开发者。

## 更新日志

### v1.0.0 (2024-12-10)
- 初始版本发布
- 实现基本的数据统计功能
- 支持文本和 HTML 格式导出
