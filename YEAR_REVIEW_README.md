# 三国杀年度回顾功能

## 简介

这是一个为三国杀游戏添加的年度回顾功能模块，可以自动统计和记录玩家的游戏数据，并生成详细的年度报告。

## 功能特性

### 📊 全面的数据统计

- **基础数据**：总场次、总胜场、胜率
- **武将统计**：最常使用的武将、各武将胜率
- **身份统计**：主公/忠臣/反贼/内奸的胜率分析
- **技能统计**：最常使用的技能排行
- **卡牌统计**：最常使用的锦囊/装备
- **战斗数据**：伤害、击杀、死亡统计
- **卡牌流转**：摸牌、弃牌数量统计

### 🎨 多种输出格式

- **文本格式**：适合在控制台查看
- **HTML格式**：美观的网页报告，可在浏览器中查看

### 🔄 自动化运行

- 游戏过程中自动记录所有数据
- 无需手动操作
- 支持多年份数据管理

## 文件说明

```
├── extensions/
│   └── year_review.lua           # 核心功能模块
├── year_review_test.lua           # 测试和使用示例
└── 年度回顾功能说明.md            # 详细使用文档
```

## 快速开始

### 1. 安装

将 `year_review.lua` 文件放入游戏的 `extensions` 目录下。

### 2. 启用

在游戏的主加载文件中添加：

```lua
require "extensions.year_review"
```

或者确保游戏会自动加载 `extensions` 目录下的所有 `.lua` 文件。

### 3. 使用

游戏会自动开始记录数据。在游戏结束后，可以通过以下方式查看回顾：

#### 查看文本报告

```lua
ShowYearReview("玩家名")
```

#### 导出HTML报告

```lua
ExportYearReviewHTML("玩家名")
```

## 数据示例

### 控制台输出示例

```
======== 2024 年度回顾 ========
玩家: Player1

【总体数据】
总场次: 100
总胜场: 58
胜率: 58.00%

【最常使用的武将】
1. 曹操 - 使用15次, 胜10场, 胜率66.67%
2. 刘备 - 使用12次, 胜8场, 胜率66.67%
3. 孙权 - 使用11次, 胜7场, 胜率63.64%

【身份统计】
主公: 25场, 胜18场, 胜率72.00%
忠臣: 25场, 胜15场, 胜率60.00%

【最常使用的技能】
1. 奸雄 - 使用145次
2. 仁德 - 使用98次

【战斗数据】
造成伤害: 678
承受伤害: 456
击杀数: 89
死亡数: 42
```

### HTML输出示例

导出的HTML文件包含：
- 现代化的网页设计
- 清晰的数据表格
- 彩色高亮显示
- 响应式布局

## 数据结构

数据存储在 `year_review_data.json` 文件中：

```json
{
  "CurrentYear": "2024",
  "PlayerStats": {
    "玩家名": {
      "2024": {
        "total_games": 100,
        "total_wins": 58,
        "generals": {
          "caocao": {
            "play_count": 15,
            "win_count": 10
          }
        },
        "skills_used": {
          "jianxiong": 145
        },
        "cards_used": {
          "slash": 234
        }
      }
    }
  }
}
```

## 高级功能

### 1. 查看历史年份数据

```lua
ShowYearReview("玩家名", "2023")
```

### 2. 批量导出

```lua
for year = 2020, 2024 do
    ExportYearReviewHTML("玩家名", tostring(year))
end
```

### 3. 数据备份

定期备份 `year_review_data.json` 文件以防数据丢失。

## 技术细节

### 触发器列表

模块注册了以下触发器来记录数据：

1. `YearReviewGameStartRecorder` - 记录游戏开始
2. `YearReviewGameOverRecorder` - 记录游戏结束
3. `YearReviewSkillRecorder` - 记录技能使用
4. `YearReviewCardRecorder` - 记录卡牌使用
5. `YearReviewDamageRecorder` - 记录伤害数据
6. `YearReviewKillRecorder` - 记录击杀/死亡
7. `YearReviewCardMoveRecorder` - 记录卡牌移动

### 性能考虑

- 所有数据操作都在游戏事件触发时进行
- 使用 JSON 格式存储，读写效率高
- 触发器优先级设置为 -10，不影响游戏逻辑

## 常见问题

### Q: 会影响游戏性能吗？
A: 影响极小，所有记录操作都是异步的，不会阻塞游戏进程。

### Q: 数据存储在哪里？
A: 存储在游戏目录下的 `year_review_data.json` 文件中。

### Q: 可以删除某些数据吗？
A: 可以直接编辑 JSON 文件删除不需要的数据。

### Q: 支持多个玩家吗？
A: 支持，每个玩家的数据独立存储。

### Q: 能统计之前的游戏吗？
A: 不能，只能统计安装后的新游戏数据。

## 更新计划

- [ ] 添加更多图表支持
- [ ] 支持数据导出为 Excel 格式
- [ ] 添加玩家对比功能
- [ ] 实现在线排行榜
- [ ] 支持自定义统计项

## 贡献

欢迎提交问题报告和功能建议！

## 许可证

本项目采用 MIT 许可证。

## 联系方式

如有问题或建议，请联系项目维护者。

---

**版本**: 1.0.0  
**更新日期**: 2024-12-10  
**兼容版本**: 三国杀 神话再临 扩展版
